# Use Fedora 42 as the base image
FROM fedora:42

# Install system dependencies including Mesa and development tools
RUN dnf install -y \
    cmake \
    git \
    gcc \
    gcc-c++ \
    make \
    ninja-build \
    wget \
    curl \
    qt5-qtbase-devel \
    fftw3-devel \
    eigen3-devel \
    boost-devel \
    libpng-devel \
    libtiff-devel \
    libjpeg-devel \
    mesa-libOSMesa-devel \  # OSMesa development libraries
    mesa-libGL-devel \     # OpenGL libraries for additional rendering support
    libX11-devel \         # X11 development libraries for Mesa
    && dnf clean all

# Set the working directory
WORKDIR /workspace

# Clone the ParaView Superbuild repository
RUN git clone --recursive https://gitlab.kitware.com/paraview/paraview-superbuild.git

# Set the working directory to the ParaView Superbuild directory
WORKDIR /workspace/paraview-superbuild

# Configure and build ParaView with OSMesa enabled
RUN mkdir build \
    && cd build \
    && cmake .. -DParaView_ENABLE_OSMESA=ON \  # Enable OSMesa
    && make -j$(nproc)  # Use all available cores for faster builds

# Set environment variables for ParaView
ENV PATH=/workspace/paraview-superbuild/build/bin:$PATH
ENV LD_LIBRARY_PATH=/workspace/paraview-superbuild/build/lib:$LD_LIBRARY_PATH

# Default command to run ParaView
CMD ["/workspace/paraview-superbuild/build/bin/paraview"]
